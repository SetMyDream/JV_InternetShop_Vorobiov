CREATE DATABASE `internet_shop`
/*!40100 DEFAULT CHARACTER SET utf8 */ /*!80016 DEFAULT ENCRYPTION='N' */;

CREATE TABLE `internet_shop`.`products`
(
    product_id bigint auto_increment
        primary key,
    name       varchar(256) default 'product' not null,
    price      double       default 0         not null,
    deleted    tinyint      default 0         not null
);

create table orders
(
    order_id bigint `internet_shop`.`auto_increment`
        primary key,
    deleted  tinyint default 0 not null,
    user_id  bigint            not null,
    constraint orders_users_fk
        foreign key (user_id) references users (user_id)
);

create index orders_users_fk_idx
    on orders (user_id);

create table `internet_shop`.`orders_products`
(
    order_id   bigint            not null,
    product_id bigint            not null,
    deleted    tinyint default 0 not null,
    constraint to_order
        foreign key (order_id) references orders (order_id),
    constraint to_product
        foreign key (product_id) references products (product_id)
);

create index to_order_idx
    on orders_products (order_id);

create index to_product_idx
    on orders_products (product_id);

create table `internet_shop`.`roles`
(
    role_id   bigint auto_increment
        primary key,
    role_name varchar(256)      not null,
    deleted   tinyint default 0 not null
);

create table `internet_shop`.`shopping_cart_products`
(
    shopping_cart_id bigint not null,
    product_id       bigint not null,
    constraint product_to_shopping_cart
        foreign key (shopping_cart_id) references shopping_carts (shopping_carts_id),
    constraint shopping_cart_to_product
        foreign key (product_id) references products (product_id)
);

create index to_product_idx
    on shopping_cart_products (product_id);

create index to_shopping_cart_idx
    on shopping_cart_products (shopping_cart_id);

create table `internet_shop`.`shopping_carts`
(
    shopping_carts_id bigint auto_increment
        primary key,
    user_id           bigint            not null,
    deleted           tinyint default 0 not null,
    constraint shopping_cart_user
        foreign key (user_id) references users (user_id)
);

create index shopping_cart_user_idx
    on shopping_carts (user_id);

create table `internet_shop`.`user_roles`
(
    user_id bigint not null,
    role_id bigint not null,
    constraint role_to_user
        foreign key (user_id) references users (user_id),
    constraint user_to_role
        foreign key (role_id) references roles (role_id)
);

create index role_to_user_idx
    on user_roles (user_id);

create index user_to_role_idx
    on user_roles (role_id);

create table `internet_shop`.`users`
(
    user_id  bigint                         not null
        primary key,
    username varchar(256) default 'No_name' not null,
    login    varchar(256)                   not null,
    password varchar(256)                   not null,
    salt     bit(16)                        not null,
    deleted  tinyint      default 0         not null,
    constraint login_UNIQUE
        unique (login)
);
